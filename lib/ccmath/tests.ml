open Matrix.Matrix4F

(** Matrix operations *)

let meq =  forall_2 Float.equal
let%test _ = meq (add id id) (diag 2.0)
let%test _ = meq (add_elem
                    [|
                      [| 0.0; 0.0; 0.0; 0.0 |];
                      [| 0.0; 0.0; 0.0; 0.0 |];
                      [| 0.0; 0.0; 0.0; 0.0 |];
                      [| 0.0; 0.0; 0.0; 0.0 |];
                    |] 1.0)
    [|
      [| 1.0; 1.0; 1.0; 1.0 |];
      [| 1.0; 1.0; 1.0; 1.0 |];
      [| 1.0; 1.0; 1.0; 1.0 |];
      [| 1.0; 1.0; 1.0; 1.0 |];
    |]
let%test _ = meq (sub
                    [|
                      [| 4.0; 4.0; 4.0; 4.0 |];
                      [| 4.0; 9.0; 4.0; 4.0 |];
                      [| 4.0; 4.0; 4.0; 4.0 |];
                      [| 4.0; 4.0; 4.0; 4.0 |];
                    |]
                    [|
                      [| 1.0; 1.0; 1.0; 1.0 |];
                      [| 1.0; 1.0; 1.0; 1.0 |];
                      [| 1.0; 1.0; 1.0; 1.0 |];
                      [| 1.0; 1.0; 1.0; 1.0 |];
                    |])

    [|
      [| 3.0; 3.0; 3.0; 3.0 |];
      [| 3.0; 8.0; 3.0; 3.0 |];
      [| 3.0; 3.0; 3.0; 3.0 |];
      [| 3.0; 3.0; 3.0; 3.0 |];
    |]

let%test _ = let case =
               [|
                 [| 2.0;-1.0; 3.0; 5.0 |];
                 [| 1.0; 3.0; 0.0; 4.0 |];
                 [| 3.0; 0.0;-1.0;-2.0 |];
                 [| 0.0; 0.0; 0.0; 1.0 |];
               |] in
  meq (mul id case) case


let%test _ = let case =
               [|
                 [| 2.0;-1.0; 3.0; 5.0 |];
                 [| 1.0; 3.0; 0.0; 4.0 |];
                 [| 3.0; 0.0;-1.0;-2.0 |];
                 [| 0.0; 0.0; 0.0; 1.0 |];
               |] in
  meq (mul id case) case

let%test _ = let case =
               [|
                 [| 2.0;-1.0; 3.0; 5.0 |];
                 [| 1.0; 3.0; 0.0; 4.0 |];
                 [| 3.0; 0.0;-1.0;-2.0 |];
                 [| 0.0; 0.0; 0.0; 1.0 |];
               |] in
  meq (mul case case)
    [|
      [| 12.0;-5.0; 3.0; 5.0 |];
      [| 5.0; 8.0; 3.0; 21.0 |];
      [| 3.0;-3.0;10.0; 15.0 |];
      [| 0.0; 0.0; 0.0; 1.0 |];
    |]


(** Quaternion tests *)
open Quaternion.QuaternionF

let%test _ = let q = from_array [| 1.0; 2.0; 3.0; 4.0 |] in
  mul_q id q = q

let%test _ = let q = from_array [| 1.0; 2.0; 3.0; 4.0 |] in
  mul_q q id = q

let%test _ = inverse id = id

(* TODO vec3 tests, matrix vector operations, quaternion vector operations *)
